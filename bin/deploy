#!/usr/bin/env bash

# Deploys the Rails app with Capistrano. 
# Usage:
#   $ bin/deploy staging

set -xea

CURRENT_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ENV_FILE=$CURRENT_PATH/../.env.$1

if [ -e $ENV_FILE ]
then
  . $ENV_FILE
fi

openssl enc -aes-256-cbc -base64 -pass pass:$DEPLOY_KEY -d -p -in $CURRENT_PATH/../config/imploder-staging.key.enc -out $CURRENT_PATH/../config/imploder-staging.key > /dev/null
cd $CURRENT_PATH/.. && bundle exec cap $1 deploy

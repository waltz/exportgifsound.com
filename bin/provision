#!/usr/bin/env bash

# Runs Ansible against the target host.
# Usage:
#   $ bin/provision staging

set -xea

STAGE=$1
CURRENT_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ENV_FILE=$CURRENT_PATH/../.env.$STAGE

if [ -e $ENV_FILE ]
then
  . $ENV_FILE
fi

UPPERCASE_STAGE=`echo $STAGE | tr [a-z] [A-Z]`
HOST=$(eval echo "\$${UPPERCASE_STAGE}_HOST")

ansible-playbook -i $HOST, $CURRENT_PATH/../server.yml
